<!DOCTYPE html>
<html><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A personal blog of z217">
  <meta name="Author" content="z217">
  <meta name="keywords" content="hugo blog">
  <link rel="icon" type="image/x-icon" href=https://z217blog.cn/favicon.ico>
  <link rel="stylesheet" href=https://z217blog.cn/css/syntax.css>
  <link rel="stylesheet" href=https://z217blog.cn/css/style.css>
  <script src="https://kit.fontawesome.com/1b7478c139.js" crossorigin="anonymous"></script>
  <title>z217&#39;s blog</title>
</head><body><aside id="sidenav">
    <header>
    
        <a href=https://z217blog.cn><img src="https://z217blog.cn/avatar.png" alt="avatar"></a>
        
    

    <a id="branding" href=https://z217blog.cn>
        
            z217&#39;s blog
        
    </a>
    </header>

    <nav>
        
            		
            <a href="/"
                
            >
                <i class="fas fa-home fa-ms"></i>
                <span>首页</span>
            </a>
        
            		
            <a href="/post/"
                
            >
                <i class="fas fa-keyboard fa-ms"></i>
                <span>文章</span>
            </a>
        
            		
            <a href="/tags"
                
            >
                <i class="fas fa-tags fa-sm"></i>
                <span>标签</span>
            </a>
        
            		
            <a href="/about"
                
            >
                <i class="fas fa-user fa-ms"></i>
                <span>关于</span>
            </a>
        
            		
            <a href="https://github.com/z217"
                
                    target="_blank"
                
            >
                <i class="fab fa-github fa-ms"></i>
                <span>Github</span>
            </a>
        
            		
            <a href="/index.xml"
                
            >
                <i class="fas fa-rss fa-sm"></i>
                <span>RSS</span>
            </a>
        
            		
            <a href="http://123.57.12.189"
                
                    target="_blank"
                
            >
                <i class="fas fa-link fa-sm"></i>
                <span>二站</span>
            </a>
        
    </nav>
</aside>
<main id="main">
            <a href="javascript:void(0)" id="closebtn" onclick="navToggle()"><i class="fas fa-bars fa-lg"></i></a>
            <div class="content">

<h1 id="title">数据库系统（6）：SQL数据定义</h1>



<h2 id="1-数据类型">1. 数据类型</h2>

<h3 id="11-标识符">1.1 标识符</h3>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>SQL</code><strong>标识符</strong> ( <span  class="math">\(identifier\)</span> ) 用于表示数据库中的对象，如表名、列名、视图名等。用户定义标识符所用的字符必须是<strong>字符集</strong> ( <span  class="math">\(character\;set\)</span> ) 中存在的。默认的字符集包括 <span  class="math">\(A-Z\)</span>, <span  class="math">\(a-z\)</span> 和 <span  class="math">\(\_\)</span> ，也可以另外指定其他字符集。标识符的限制有：</p>

<ul>
<li>不能长于 <span  class="math">\(128\)</span> 个字符（在一些方言中会更短）</li>
<li>必须以字母开头</li>
<li>不能有空格</li>
</ul>

<h3 id="12-数据类型">1.2 数据类型</h3>

<table>
<thead>
<tr>
<th align="left">数据类型</th>
<th align="left">声明</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">布尔型</td>
<td align="left"><span  class="math">\(BOOLEAN\)</span></td>
</tr>

<tr>
<td align="left">字符型</td>
<td align="left"><span  class="math">\(CHAR\)</span>, <span  class="math">\(VARCHAR\)</span></td>
</tr>

<tr>
<td align="left">位类型</td>
<td align="left"><span  class="math">\(BIT\)</span>, <span  class="math">\(BIT\;VARYING\)</span></td>
</tr>

<tr>
<td align="left">定点数型</td>
<td align="left"><span  class="math">\(NUMERIC\)</span>, <span  class="math">\(DECIMAL\)</span>, <span  class="math">\(INTEGER\)</span>, <span  class="math">\(SMALLINT\)</span>, <span  class="math">\(BIGINT\)</span></td>
</tr>

<tr>
<td align="left">浮点数型</td>
<td align="left"><span  class="math">\(FLOAT\)</span>, <span  class="math">\(REAL\)</span>, <span  class="math">\(DOUBLE\;PRECISION\)</span></td>
</tr>

<tr>
<td align="left">日期时间型</td>
<td align="left"><span  class="math">\(DATE\)</span>, <span  class="math">\(TIME\)</span>, <span  class="math">\(TIMESTAMP\)</span></td>
</tr>

<tr>
<td align="left">间隔型</td>
<td align="left"><span  class="math">\(INTERVAL\)</span></td>
</tr>

<tr>
<td align="left">大对象型</td>
<td align="left"><span  class="math">\(CHARACTER\;LARGE\;OBJECT\)</span>, <span  class="math">\(BINARY\;LARGE\;OBJECT\)</span></td>
</tr>
</tbody>
</table>

<h4 id="121-布尔型">1.2.1 布尔型</h4>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;布尔型包括 <span  class="math">\(TRUE\)</span> / <span  class="math">\(FALSE\)</span> 两个值，如果没有 <span  class="math">\(NOT\;NULL\)</span> 约束，也可以为 <span  class="math">\(NULL\)</span> 。<span  class="math">\(TRUE\)</span> 大于 <span  class="math">\(FALSE\)</span> ，对于涉及 <span  class="math">\(NULL\)</span> 的比较，结果都是 <span  class="math">\(UNKNOWN\)</span> 。</p>

<h4 id="122-字符型">1.2.2 字符型</h4>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;字符型数据是由字符集中的字符组成的序列，由方言供应商提供。<span  class="math">\(CHAR\)</span> 为固定长度，当输入字符串小于指定长度时会使用空格补足。<span  class="math">\(VARCHAR\)</span> 为变化长度，只会存储输入的字符，不会补足。</p>

<h4 id="123-位类型">1.2.3 位类型</h4>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;位类型用于定义位字符串，即二进制序列。为了操作方便，有时候会将字符型和位类型合称为字符串型。</p>

<h4 id="124-定点数型">1.2.4 定点数型</h4>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;定点数据类型用于定义准确表示的数值。对于 <span  class="math">\(NUMERIC\)</span> 和 <span  class="math">\(DECIMAL\)</span> ，应指定<strong>精度</strong> ( <span  class="math">\(precision\)</span> ) 和 <strong>小数位</strong> ( <span  class="math">\(scale\)</span> ) 。精度为全部位数，小数位为小数部分的位数。</p>

<h4 id="125-浮点数型">1.2.5 浮点数型</h4>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;浮点数据类型用于定义非精确的数字，如实数，采用类似于科学计数法的表示方式。为了操作方便，有时会将定点数型和浮点数型合称为数值数据类型。对于 <span  class="math">\(FLOAT\)</span> ，需要指定精度。而 <span  class="math">\(REAL\)</span> 和 <span  class="math">\(DOUBLE\;PRECISION\)</span> 的精度则依赖于具体实现。</p>

<h4 id="126-日期时间型">1.2.6 日期时间型</h4>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;日期时间类型用于定义一定精度的时间。<code>ISO</code>标准将日期时间类型分为 <span  class="math">\(YEAR\)</span>, <span  class="math">\(MONTH\)</span>, <span  class="math">\(DAY\)</span>, <span  class="math">\(HOUR\)</span>, <span  class="math">\(MINUTE\)</span>, <span  class="math">\(SECOND\)</span>, <span  class="math">\(TIMEZONE\_HOUR\)</span> 和 <span  class="math">\(TIMEZONE\_MINUTE\)</span> 。后面两个字段指定从<code>GMT</code>时区偏移的小时数和分钟数。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span  class="math">\(DATE\)</span> 用于存储 <span  class="math">\(YEAR\)</span>, <span  class="math">\(MONTH\)</span>, <span  class="math">\(DAY\)</span> 。<span  class="math">\(TIME\)</span> 用于存储 <span  class="math">\(HOUR\)</span>, <span  class="math">\(MINUTE\)</span>, <span  class="math">\(SECOND\)</span> 。<span  class="math">\(TIMESTAMP\)</span> 用于存储上述全部。对于 <span  class="math">\(TIME\)</span> 和 <span  class="math">\(TIMESTAMP\)</span> ，需要指定时间精度，即秒的精度。在 <span  class="math">\(TIME\)</span> 和 <span  class="math">\(TIMESTAMP\)</span> 最后可以声明 <span  class="math">\(WITH\;TIME\;ZONE\)</span> ，用于指定 <span  class="math">\(TIMEZONE\_HOUR\)</span> 和 <span  class="math">\(TIMEZONE\_MINUTE\)</span> 。</p>

<h4 id="127-间隔型">1.2.7 间隔型</h4>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;间隔数据类型表示一段时间。每个间隔类型由下列字段的一个连续子集构成：<span  class="math">\(YEAR\)</span>, <span  class="math">\(MONTH\)</span>, <span  class="math">\(DAY\)</span>, <span  class="math">\(HOUR\)</span>, <span  class="math">\(MINUTE\)</span>, <span  class="math">\(SECOND\)</span> 。间隔数据类型分为年-月间隔和天-时间间隔，前者只能包括 <span  class="math">\(YEAR\)</span> 和 <span  class="math">\(MONTH\)</span> ，后者可以从 <span  class="math">\(DAY\)</span>, <span  class="math">\(HOUR\)</span>, <span  class="math">\(MINUTE\)</span>, <span  class="math">\(SECOND\)</span> 中选择连续的一段。声明格式如下</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="nb">INTERVAL</span> <span class="err">{{</span><span class="n">startField</span> <span class="k">TO</span> <span class="n">endField</span><span class="err">}</span> <span class="n">singleDatetimeField</span><span class="err">}</span>

<span class="n">startField</span> <span class="o">=</span> <span class="k">YEAR</span> <span class="o">|</span> <span class="k">MONTH</span> <span class="o">|</span> <span class="k">DAY</span> <span class="o">|</span> <span class="n">HOUR</span> <span class="o">|</span> <span class="k">MINUTE</span> <span class="p">[(</span><span class="n">intervalLeadingFieldPrecision</span><span class="p">)]</span>
<span class="n">endField</span> <span class="o">=</span> <span class="k">YEAR</span> <span class="o">|</span> <span class="k">MONTH</span> <span class="o">|</span> <span class="k">DAY</span> <span class="o">|</span> <span class="n">HOUR</span> <span class="o">|</span> <span class="k">MINUTE</span> <span class="o">|</span> <span class="k">SECOND</span> <span class="p">[(</span><span class="n">fractionalSecondsPrecision</span><span class="p">)]</span>
<span class="n">singleDatetimeField</span> <span class="o">=</span> <span class="n">startField</span> <span class="o">|</span> <span class="k">SECOND</span> <span class="p">[(</span><span class="n">intervalLeadingFieldPrecision</span><span class="p">[,</span> <span class="n">fractionalSecondsPrecision</span><span class="p">])]</span></code></pre></div>
<h4 id="128-大对象型">1.2.8 大对象型</h4>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;大对象数据类型用于表示大量数据。<code>SQL</code>可定义三类大对象数据类型：二进制大对象 ( <span  class="math">\(BLOB\)</span> )、字符大对象 ( <span  class="math">\(CLOB\)</span> ) 和自然字符大对象 ( <span  class="math">\(NCLOB\)</span> )，前者为二进制串，后两者都是字符串。</p>

<h2 id="2-完整性增强特性">2. 完整性增强特性</h2>

<p>完整性约束有五种类型：</p>

<ul>
<li>必须有值的数据</li>
<li>域约束</li>
<li>实体完整性</li>
<li>引用完整性</li>
<li>一般性约束</li>
</ul>

<h3 id="21-必须有值的数据">2.1 必须有值的数据</h3>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;某些的列的值不允许为空，可以通过 <span  class="math">\(NOT\;NULL\)</span> 指定。若不指定或者指定为 <span  class="math">\(NULL\)</span> ，则接受空。<code>ISO</code>的默认值为 <span  class="math">\(NULL\)</span> 。</p>

<h3 id="22-域约束">2.2 域约束</h3>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;每一列都有一个域，即合法值的集合。<code>ISO</code>标准在 <span  class="math">\(CREATE\)</span> 和 <span  class="math">\(ALTER\;TABLE\)</span> 中可以使用 <span  class="math">\(CHECK\)</span> 子句对列或者整个表进行约束。</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sex</span> <span class="nb">CHAR</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">CHECK</span><span class="p">(</span><span class="n">sex</span> <span class="k">IN</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">))</span></code></pre></div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;也可以使用 <span  class="math">\(CREATE\;DOMAIN\)</span> 定义域。</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">DOMAIN</span> <span class="n">DomainName</span> <span class="p">[</span><span class="k">AS</span><span class="p">]</span> <span class="n">dateType</span>
<span class="p">[</span><span class="k">DEFAULT</span> <span class="n">defaultOption</span><span class="p">]</span>
<span class="p">[</span><span class="k">CHECK</span> <span class="p">(</span><span class="n">searchCondition</span><span class="p">)]</span>

<span class="k">DROP</span> <span class="k">DOMAIN</span> <span class="n">DomainName</span> <span class="p">[</span><span class="k">RESTRICT</span><span class="o">|</span><span class="k">CASCADE</span><span class="p">]</span></code></pre></div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span  class="math">\(DROP\;DOMAIN\)</span> 用于删除。<span  class="math">\(RESTRICT\)</span> 或 <span  class="math">\(CASCADE\)</span> 指出如果域正在被使用时应采取的行为，<span  class="math">\(RESTRICTION\)</span> 是只有当域未被使用时才能删除，<span  class="math">\(CASCADE\)</span> 则将列的域变为基类型定义。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;如下所示：</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">DOMAIN</span> <span class="n">SexType</span> <span class="k">AS</span> <span class="nb">CHAR</span>
    <span class="k">DEFAULT</span> <span class="s1">&#39;M&#39;</span>
    <span class="k">CHECK</span><span class="p">(</span><span class="n">VALUE</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">));</span></code></pre></div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在创建表时进行使用：</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">sex</span> <span class="n">SexType</span> <span class="k">NOT</span> <span class="k">NULL</span></code></pre></div>
<h3 id="23-实体完整性">2.3 实体完整性</h3>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;表中每一行的主键必须是唯一非空值。<code>ISO</code>标准在 <span  class="math">\(CREATE\)</span> / <span  class="math">\(ALTER\;TABLE\)</span> 中使用 <span  class="math">\(PRIMARY\;KEY\)</span> 支持实体完整性。对于非主键的列，如果要支持唯一性，可以使用 <span  class="math">\(UNIQUE\)</span> 指定。</p>

<h3 id="24-引用完整性">2.4 引用完整性</h3>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;外键是某个列或者列集合，把包含外键的子表中的每个元组与父表中包含候选键的元组关联起来。外键必须是父表中已存在的有效元组。<code>ISO</code>标准可以在 <span  class="math">\(CREATE\)</span> / <span  class="math">\(ALTER\;TABLE\)</span> 中使用 <span  class="math">\(FOREIGN\;KEY\)</span> 定义外键。</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">columnList</span><span class="p">)</span>
<span class="k">REFERENCES</span> <span class="n">tableName</span> <span class="p">[</span><span class="k">ON</span> <span class="err">{</span><span class="k">DELETE</span> <span class="o">|</span> <span class="k">UPDATE</span><span class="err">}</span> <span class="err">{</span><span class="k">CASCADE</span> <span class="o">|</span> <span class="k">SET</span> <span class="k">NULL</span> <span class="o">|</span> <span class="k">SET</span> <span class="k">DEFAULT</span> <span class="o">|</span> <span class="k">NO</span> <span class="n">ACTION</span><span class="err">}</span><span class="p">]</span></code></pre></div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在子表中，如果试图使用 <span  class="math">\(INSERT\)</span> / <span  class="math">\(UPDATE\)</span> 创建与父表的候选键不匹配的外键，则会被拒绝。<span  class="math">\(ON\;DELETE\)</span> / <span  class="math">\(UPDATE\)</span> 子句决定在父表中进行 <span  class="math">\(DELETE\)</span> / <span  class="math">\(UPDATE\)</span> 操作时子表的行为：</p>

<ul>
<li><span  class="math">\(CASCADE\)</span> ：删除/更新父表中的行时会自动删除/更新子表中的列。如果列中的候选键是其他的表的外键，那么会触发级联删除/更新；</li>
<li><span  class="math">\(SET\;NULL\)</span> ：删除/更新父表中的行时会自动设置子表中外键的值为 <span  class="math">\(NULL\)</span> ，但要求外键未指定 <span  class="math">\(NOT\;NULL\)</span> ；</li>
<li><span  class="math">\(SET\;DEFAULT\)</span> ：删除/更新父表中的行时会自动设置子表中外键的值为默认值，但要求外键指定 <span  class="math">\(DEFAULT\)</span> ；</li>
<li><span  class="math">\(NO\;ACTION\)</span> ：拒绝对父表进行删除/更新操作，是 默认规则。</li>
</ul>

<h3 id="25-一般性约束">2.5 一般性约束</h3>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;对表的更新可能受到的企业规则的约束。<code>ISO</code>允许使用 <span  class="math">\(CREATE\)</span> / <span  class="math">\(ALTER\;TABLE\)</span> 中的 <span  class="math">\(CHECK\)</span> / <span  class="math">\(UNIQUE\)</span> 以及 <span  class="math">\(CREATE\;ASSERTION\)</span> 指定一般性约束。</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">ASSERTION</span> <span class="n">assertionName</span>
<span class="k">CHECK</span><span class="p">(</span><span class="n">searchCondition</span><span class="p">)</span></code></pre></div>
<h2 id="3-数据定义">3. 数据定义</h2>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>DDL</code>允许创建和删除数据库对象。主要的数据定义语句为：</p>

<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">$CREATE$</th>
<th align="center">$ALTER$</th>
<th align="center">$DROP$</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">$SCHEMA$</td>
<td align="center">$\surd$</td>
<td align="center"></td>
<td align="center">$\surd$</td>
</tr>

<tr>
<td align="center">$DOMAIN$</td>
<td align="center">$\surd$</td>
<td align="center">$\surd$</td>
<td align="center">$\surd$</td>
</tr>

<tr>
<td align="center">$TABLE$</td>
<td align="center">$\surd$</td>
<td align="center">$\surd$</td>
<td align="center">$\surd$</td>
</tr>

<tr>
<td align="center">$VIEW$</td>
<td align="center">$\surd$</td>
<td align="center"></td>
<td align="center">$\surd$</td>
</tr>
</tbody>
</table>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;此外虽然许多<code>DBMS</code>支持 <span  class="math">\(CREATE\)</span> / <span  class="math">\(DROP\;INDEX\)</span> ，但是<code>SQL</code>标准并不支持。</p>

<h3 id="31-数据库">3.1 数据库</h3>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;根据<code>ISO</code>标准，关系和其他的数据库对象都存在于某个<strong>环境</strong> ( <span  class="math">\(environment\)</span> ) 中，每个环境含有一个或多个<strong>目录</strong> ( <span  class="math">\(catalogs\)</span> )，每个目录包括一组<strong>模式</strong> ( <span  class="math">\(schemas\)</span> )。模式是一组数据库对象的明明集合，该集合中的对象以某种方式相互关连。对象可以是表、视图、域、字符集等，具有相同的所有者并且共享若干的默认值。</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="p">[</span><span class="n">Name</span> <span class="o">|</span> <span class="k">AUTHORIZATION</span> <span class="n">creatorIdentifier</span><span class="p">]</span>

<span class="k">DROP</span> <span class="k">SCHEMA</span> <span class="n">Name</span> <span class="p">[</span><span class="k">RESTRICT</span> <span class="o">|</span> <span class="k">CASCADE</span><span class="p">]</span></code></pre></div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span  class="math">\(AUTHORIZATION\)</span> 指定模式的创建者。<span  class="math">\(RESTRICT\)</span> 限制只有模式为空时才能删除，<span  class="math">\(CASCADE\)</span> 则会级联删除所有与该模式相关的对象。</p>

<h3 id="32-表">3.2 表</h3>

<h4 id="321-创建">3.2.1 创建</h4>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tableName</span>
    <span class="err">{</span><span class="p">(</span><span class="n">columnName</span> <span class="n">dateType</span> <span class="p">[</span><span class="k">NOT</span> <span class="k">NULL</span><span class="p">]</span> <span class="p">[</span><span class="k">UNIQUE</span><span class="p">]</span> <span class="p">[</span><span class="k">DEFAULT</span> <span class="n">defaultOption</span><span class="p">]</span> <span class="p">[</span><span class="k">CHECK</span><span class="p">(</span><span class="n">searchCondition</span><span class="p">)]</span>
    <span class="p">[,...])</span><span class="err">}</span>
    <span class="p">[</span><span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">columnList</span><span class="p">)]</span>
    <span class="err">{</span><span class="p">[</span><span class="k">UNIQUE</span><span class="p">(</span><span class="n">columnList</span><span class="p">)[,...]]</span><span class="err">}</span>
    <span class="err">{</span><span class="p">[</span><span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">columnList</span><span class="p">)</span>
    <span class="k">REFERENCES</span> <span class="n">tableName</span><span class="p">[(</span><span class="n">columnList</span><span class="p">)]]</span>
        <span class="p">[</span><span class="k">MATCH</span> <span class="err">{</span><span class="k">PARTIAL</span> <span class="o">|</span> <span class="k">FULL</span><span class="err">}</span>
        <span class="p">[</span><span class="k">ON</span> <span class="k">UPDATE</span> <span class="n">referentialAction</span><span class="p">]</span>
        <span class="p">[</span><span class="k">ON</span> <span class="k">DELETE</span> <span class="n">referentialAction</span><span class="p">]][,...]</span><span class="err">}</span>
    <span class="err">{</span><span class="p">[</span><span class="k">CHECK</span><span class="p">(</span><span class="n">searchCondition</span><span class="p">)][,...]</span><span class="err">}</span></code></pre></div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span  class="math">\(PRIMARY\;KEY\)</span> 及之后的子句统称为表约束，可以选择下列句子作为前缀：</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CONSTRAINT</span> <span class="n">constraintName</span></code></pre></div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;通过这种方式，之后可以使用 <span  class="math">\(ALTER\;TABLE\)</span> 删除约束。外键中的 <span  class="math">\(MATCH\)</span> 选项对外键中存在空的情况施加另外限制。如果指定为 <span  class="math">\(FULL\)</span> ，则外键全为空或全不为空。如果指定为 <span  class="math">\(PARTIAL\)</span> ，则外键各列或者全为空，或者说当为空的列被代入时，父表中至少有有一行能满足约束。</p>

<h4 id="322-修改">3.2.2 修改</h4>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tableName</span>
<span class="p">[</span><span class="k">ADD</span> <span class="p">[</span><span class="k">COLUMN</span><span class="p">]</span> <span class="n">columnName</span> <span class="n">dataType</span> <span class="p">[</span><span class="k">NOT</span> <span class="k">NULL</span><span class="p">]</span> <span class="p">[</span><span class="k">UNIQUE</span><span class="p">]</span>
<span class="p">[</span><span class="k">DEFAULT</span> <span class="n">defaultOption</span><span class="p">]</span>
<span class="p">[</span><span class="k">CHECK</span><span class="p">(</span><span class="n">searchCondition</span><span class="p">)]]</span>
<span class="p">[</span><span class="k">DROP</span> <span class="p">[</span><span class="k">COLUMN</span><span class="p">]</span> <span class="n">columnName</span> <span class="p">[</span><span class="k">RESTRICT</span> <span class="o">|</span> <span class="k">CASCADE</span><span class="p">]]</span>
<span class="p">[</span><span class="k">ADD</span> <span class="p">[</span><span class="k">CONSTRAINT</span> <span class="p">[</span><span class="n">constraintName</span><span class="p">]]</span> <span class="n">tableConstraintDefinition</span><span class="p">]</span>
<span class="p">[</span><span class="k">DROP</span> <span class="k">CONSTRAINT</span> <span class="n">constraintName</span> <span class="p">[</span><span class="k">RESTRICT</span> <span class="o">|</span> <span class="k">CASCADE</span><span class="p">]]</span>
<span class="p">[</span><span class="k">ALTER</span> <span class="p">[</span><span class="k">COLUMN</span><span class="p">]</span> <span class="k">SET</span> <span class="k">DEFAULT</span> <span class="n">defaultOption</span><span class="p">]</span>
<span class="p">[</span><span class="k">ALTER</span> <span class="p">[</span><span class="k">COLUMN</span><span class="p">]</span> <span class="k">DROP</span> <span class="k">DEFAULT</span><span class="p">]</span></code></pre></div>
<h4 id="323-删除">3.2.3 删除</h4>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">tableName</span> <span class="p">[</span><span class="k">RESTRICT</span> <span class="o">|</span> <span class="k">CASCADE</span><span class="p">]</span></code></pre></div>
<h3 id="33-索引">3.3 索引</h3>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;索引是一种结构，提供了一个或多个列值得快速访问表中元组的方法。索引极大地提高了查询的性能。然而，由于每更新一次基本关系时都可能会更新索引，所以可能会导致额外的开销。<code>SQL</code>并未创建索引的标准，但大多数实现可以支持下列语句：</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="p">[</span><span class="k">UNIQUE</span><span class="p">]</span> <span class="k">INDEX</span> <span class="n">indexName</span>
<span class="k">ON</span> <span class="n">tableName</span><span class="p">(</span><span class="n">columnName</span> <span class="p">[</span><span class="k">ASC</span> <span class="o">|</span> <span class="k">DESC</span><span class="p">][,...])</span></code></pre></div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;指定的列构成索引关键字，按照从主到次的顺序排列。索引只能基于基表建立，不能基于视图。</p>

<h2 id="4-视图">4. 视图</h2>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;视图是为了得到另一个关系而对基关系进行一次或多次关系操作所得到的动态结果。视图是虚关系，只在需要时根据特定用户的要求临时生成。对于用户来说，视图像真实表一样。<code>DBMS</code>只存储视图的定义，当遇到视图引用时，再将请求转换为对源表的等价请求。这个转换过程称为<strong>视图分解</strong> ( <span  class="math">\(view\;resolution\)</span> )。也可以通过<strong>视图物化</strong> ( <span  class="math">\(view\;materialization\)</span> ) 实现，即把视图存储在数据库的临时表中，并在基表变化时更新临时表。</p>

<h3 id="41-创建">4.1 创建</h3>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">viewName</span> <span class="p">[(</span><span class="n">newColumnName</span><span class="p">[,...])]</span>
<span class="k">AS</span> <span class="n">subselect</span> <span class="p">[</span><span class="k">WITH</span> <span class="p">[</span><span class="k">CASCADE</span> <span class="o">|</span> <span class="k">LOCAL</span><span class="p">]</span> <span class="k">CHECK</span> <span class="k">OPTION</span><span class="p">]</span></code></pre></div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span  class="math">\(subselect\)</span> 称为<strong>定义查询</strong> ( <span  class="math">\(defining\;query\)</span> ) 。在定义查询中使用 <span  class="math">\(ORDER\;BY\)</span> 子句的视图称为分组视图，如果使用了 <span  class="math">\(JOIN\)</span> 子句的视图称为连接视图。如果指定 <span  class="math">\(WITH\;CHECK\;OPTION\)</span> ，那么哪些不满足定义查询中 <span  class="math">\(WHERE\)</span> 子句的行不会添加到视图的基表中。</p>

<h3 id="42-删除">4.2 删除</h3>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">DROP</span> <span class="k">VIEW</span> <span class="n">viewName</span> <span class="p">[</span><span class="k">RESTRICT</span> <span class="o">|</span> <span class="k">CASCADE</span><span class="p">]</span></code></pre></div>
<h3 id="43-视图的局限性">4.3 视图的局限性</h3>

<ol>
<li>如果视图中的某个列基于聚合函数，那么在访问它语句中，该列只能出现在 <span  class="math">\(SELECT\)</span> / <span  class="math">\(ORDER\;BY\)</span> 子句中</li>
<li>分组视图不能与基表或者视图连接</li>
</ol>

<h3 id="44-视图的可更新性">4.4 视图的可更新性</h3>

<ol>
<li>没有指定 <span  class="math">\(DISTINCT\)</span> ，即未删除重复元组</li>
<li>定义查询中 <span  class="math">\(SELECT\)</span> 列表的每个元素都是列名，即非常量、表达式或者聚合函数，且每个列名最多出现一次</li>
<li><span  class="math">\(FROM\)</span> 只指定一个表，并且用户对该表具有一定的权限</li>
<li><span  class="math">\(WHERE\)</span> 子句不能包括任何引用了 <span  class="math">\(FROM\)</span> 子句中的表的嵌套 <span  class="math">\(SELECT\)</span> 操作</li>
<li>定义查询中不能有 <span  class="math">\(GROUP\;BY\)</span> 或者 <span  class="math">\(HAVING\)</span> 子句</li>
</ol>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这些限制的蕴含为：对于任何一个行或者列，<code>DBMS</code>必须能追溯到其源表中相应的行或者列。</p>

<h3 id="45-with-check-option">4.5 WITH CHECK OPTION</h3>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;视图中的行均满足定义查询中 <span  class="math">\(WHERE\)</span> 子句的条件。如果某行经过修改后不满足，则应该将其从视图中移除。相应的，如果某行在修改后满足，则应移入视图中。对于发生这种改变的行，我们称之为<strong>迁移行</strong> ( <span  class="math">\(migrating\;rows\)</span> )。<span  class="math">\(WITH\;CHECK\;OPTION\)</span> 子句用于禁止行迁移出视图。<span  class="math">\(LOCAL\)</span> 修饰词在该视图或者其导出视图上进行插入或者更新操作时，禁止行迁移出视图，除非该行也从底层视图或者表中迁移出。<span  class="math">\(CASCADED\)</span> 修饰词是默认设置，在该视图或者其导出视图上进行插入或者更新操作时，禁止所有行迁移出视图。</p>

<h3 id="46-视图的优缺点">4.6 视图的优缺点</h3>

<h4 id="461-优点">4.6.1 优点</h4>

<ol>
<li>数据独立性。即使底层源发生了变化，只要不影响到视图所需的列，那么视图的定义就不需要改变；</li>
<li>实时性。对基表的任何改变都会立即反映到视图上；</li>
<li>提高安全性。用户只能访问可以访问的视图；</li>
<li>降低复杂性。将多表查询转换为单表查询；</li>
<li>方便。只需要提供用户想看到的内容；</li>
<li>用户化。同一个表可以被不同用户以不同方式查看；</li>
<li>数据完整性。通过 <span  class="math">\(WITH\;CHECK\;OPTION\)</span> ，任何不满足定义查询中 <span  class="math">\(WHERE\)</span> 子句的行不会通过视图加入基表，确保了视图的完整性。</li>
</ol>

<h4 id="462-缺点">4.6.2 缺点</h4>

<ol>
<li>更新局限性。在某些情况下视图无法更新；</li>
<li>结构局限性。一旦视图被定义，那么后续无法修改其查询语句；</li>
<li>性能开销。使用视图会带来一定的性能开销。</li>
</ol>

<h2 id="5-事务">5. 事务</h2>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;事务是由一个或者多个<code>SQL</code>语句组成的逻辑工作单元，通过恢复机制可以保证其原子性。当用户或者程序执行事务初始化语句，如 <span  class="math">\(SELECT\)</span>, <span  class="math">\(INSERT\)</span>, <span  class="math">\(UPDATE\)</span> 等，<code>SQL</code>事务自动开始。结束事务有四种方式：</p>

<ul>
<li><span  class="math">\(COMMIT\)</span> ，提交事务并持久化数据库</li>
<li><span  class="math">\(ROLLBACK\)</span> ，撤销事务并回退至事务执行之前</li>
<li>终止程序。对于程序式<code>SQL</code>，这意味着提交事务。对于非程序式<code>SQL</code>，这意味着撤销事务。</li>
</ul>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span  class="math">\(SET\;TRANSACTION\)</span> 语句允许用户配置事务的某些特性：</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SET</span> <span class="k">TRANSACTION</span>
<span class="p">[</span><span class="k">READ</span> <span class="k">ONLY</span> <span class="o">|</span> <span class="k">READ</span> <span class="k">WRITE</span><span class="p">]</span> <span class="o">|</span>
<span class="p">[</span><span class="k">ISOLATION</span> <span class="k">LEVEL</span> <span class="k">READ</span> <span class="k">UNCOMMITTED</span> <span class="o">|</span> <span class="k">READ</span> <span class="k">COMMITTED</span> <span class="o">|</span> <span class="k">REPEATABLE</span> <span class="k">READ</span> <span class="o">|</span> <span class="k">SERIALIZABLE</span><span class="p">]</span></code></pre></div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span  class="math">\(READ\;ONLY/WRITE\)</span> 表示事务的读写型，默认为可读写。隔离级表示事务执行过程中允许的与其他事务的交互程度。</p>

<h2 id="6-自主访问控制">6. 自主访问控制</h2>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>DBMS</code>通常提供一种或两种授权机制：<em>自主访问控制</em> ( <span  class="math">\(discretionary\;access\;control\)</span> ) 和<em>强制访问控制</em> ( <span  class="math">\(mandatory\;access\;control\)</span> ) 。在自主访问控制中，每个用户会被授予对特定数据库对象的适当的访问权限。在强制访问控制中，每个数据库对象会被分级。<code>SQL</code>通过 <span  class="math">\(GRANT\)</span> 和 <span  class="math">\(REVOKE\)</span> 语句来支持自主访问控制，基于<em>授权标识符</em> ( <span  class="math">\(authorization\;identifiers\)</span> ) ，<em>所有权</em> ( <span  class="math">\(ownership\)</span> ) 和<em>权限</em> ( <span  class="math">\(privileges\)</span> ) 。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;授权标识符是<code>SQL</code>用于辨别用户的一般标识符，每个用户都由数据库管理员分配一个授权标识符。通常这个标识符都与一个密码相关联。可以用授权标识符确定用户可以访问哪些对象，能对对象进行哪些操作。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>SQL</code>中的每个对象都有一个所有者，即创建该对象所属模式时 <span  class="math">\(AUTHORIZATION\)</span> 指定的授权标识符。在最初，只有所有者知道对象存在，并能对其进行任何操作。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;权限是指允许用户对指定基表或视图进行的操作，包括：</p>

<ul>
<li><span  class="math">\(SELECT\)</span> ：查询表中数据</li>
<li><span  class="math">\(INSERT\)</span> ：向表中插入数据，可以限制到指定列</li>
<li><span  class="math">\(UPDATE\)</span> ：更新表中数据，可以限制到指定列</li>
<li><span  class="math">\(DELETE\)</span> ：删除表中数据</li>
<li><span  class="math">\(REFERENCES\)</span> ：完整性约束中引用指定表中列</li>
<li><span  class="math">\(USAGE\)</span> ：使用域、序列、字符集和转变规则</li>
</ul>

<h3 id="61-授予权限">6.1 授予权限</h3>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">GRANT</span> <span class="err">{</span><span class="n">privilegeList</span> <span class="o">|</span> <span class="k">ALL</span> <span class="k">PRIVILEGES</span><span class="err">}</span>
<span class="k">ON</span> <span class="n">objectName</span>
<span class="k">TO</span> <span class="err">{</span><span class="n">authorizationIdList</span> <span class="o">|</span> <span class="k">PUBLIC</span><span class="err">}</span>
<span class="p">[</span><span class="k">WITH</span> <span class="k">GRANT</span> <span class="k">OPTION</span><span class="p">]</span></code></pre></div>
<h3 id="62-撤销权限">6.2 撤销权限</h3>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">REVOKE</span> <span class="p">[</span><span class="k">GRANT</span> <span class="k">OPTION</span> <span class="k">FOR</span><span class="p">]</span> <span class="err">{</span><span class="n">privilegeList</span> <span class="o">|</span> <span class="k">ALL</span> <span class="k">PRIVILEGES</span><span class="err">}</span>
<span class="k">ON</span> <span class="n">objectName</span>
<span class="k">FROM</span> <span class="err">{</span><span class="n">authorizationIdList</span> <span class="o">|</span> <span class="k">PUBLIC</span><span class="err">}</span> <span class="p">[</span><span class="k">RESTRICT</span> <span class="o">|</span> <span class="k">CASCADE</span><span class="p">]</span></code></pre></div>

<div class="nav-next-prev">
    <div class="nav-prev">
        
        <a href="https://z217blog.cn/post/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F5sql%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/"><i class="fas fa-chevron-left"></i></a>
        
    </div>
    <a class="nav-top" href="#">回到顶部</i></a>
    <div class="nav-next">
        
        <a href="https://z217blog.cn/post/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F7er%E6%A8%A1%E5%9E%8B/"><i class="fas fa-chevron-right"></i></a>
        
    </div>
</div>


            </div><footer>
    <div class="footer-content">
        
        <div class="contact-info">
            
            <div class="footer-github">
                <i class="fab fa-github fa-ms"></i> <a target="_blank" href="https://github.com/z217">github.com/z217</a>
            </div>
            
            
            <div class="footer-mail">
                <i class="far fa-envelope"></i> <a href="mailto:mailto:zihan.zhouchn@outlook.com">mailto:zihan.zhouchn@outlook.com</a> </div>
            
            
        </div>
        
        
        <p class="copyright meta">Copyright © 2020–2020, z217 and the Hugo Authors; all rights reserved. Theme: <a target="_blank"
                href="https://github.com/ahmedsaadxyzz/npq-hugo">npq-hugo</a></p>
        
    </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script></main>
    </body>
    <script src=https://z217blog.cn/js/navbutton.js></script>
</html>
