<!DOCTYPE html>
<html><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A personal blog of z217">
  <meta name="Author" content="z217">
  <meta name="keywords" content="hugo blog">
  <link rel="icon" type="image/x-icon" href=https://z217blog.cn/favicon.ico>
  <link rel="stylesheet" href=https://z217blog.cn/css/syntax.css>
  <link rel="stylesheet" href=https://z217blog.cn/css/style.css>
  <script src="https://kit.fontawesome.com/1b7478c139.js" crossorigin="anonymous"></script>
  
  <title>z217&#39;s blog</title>
</head><script src=https://z217blog.cn/js/jquery-3.4.1.min.js></script>
<script src=https://z217blog.cn/js/navbutton.js></script>

<body><aside id="sidenav">
    <header>
        
        <a href=https://z217blog.cn><img src="https://z217blog.cn/avatar.png" alt="avatar"></a>

        

        <a id="branding" href=https://z217blog.cn>
            
            z217&#39;s blog
            
        </a>
    </header>

    <nav>
        
        
        <a href="/" >
            <i class="fas fa-home fa-ms"></i>
            <span>首页</span>
        </a>
        
        
        <a href="/post/" >
            <i class="fas fa-keyboard fa-ms"></i>
            <span>文章</span>
        </a>
        
        
        <a href="/tags" >
            <i class="fas fa-tags fa-sm"></i>
            <span>标签</span>
        </a>
        
        
        <a href="/about" >
            <i class="fas fa-user fa-ms"></i>
            <span>关于</span>
        </a>
        
        
        <a href="https://github.com/z217"  target="_blank" >
            <i class="fab fa-github fa-ms"></i>
            <span>Github</span>
        </a>
        
        
        <a href="/index.xml" >
            <i class="fas fa-rss fa-sm"></i>
            <span>RSS</span>
        </a>
        
        
        <a href="/friend" >
            <i class="fas fa-map fa-sm"></i>
            <span>友链</span>
        </a>
        
    </nav>
</aside><main id="main">
        <a href="javascript:void(0)" id="closebtn" onclick="navToggle()"><i class="fas fa-bars fa-lg"></i></a>
        <div class="content">

<h1 id="title">JVM（4）：Class文件结构</h1>


<h2 id="1-平台无关性">1. 平台无关性</h2>
<p>        <code>Java</code>在刚刚诞生时就有一句非常著名的口号：一次编写，到处运行。这个想法通过虚拟机实现，这些虚拟机都可以执行同一种与平台无关的字节码，从而达到一次编写，到处运行。可以说，字节码就是平台无关性的基石。<code>Java</code>虚拟机并不与<code>Java</code>语言绑定，在其之上还可以运行许多其他语言，如<code>Kotlin</code>、<code>Groovy</code>和<code>Scala</code>等。<code>Java</code>虚拟机唯一绑定的是类似于<code>Class</code>文件这种特殊的二进制文件，其中包含了<code>Java</code>虚拟机的指令集、符号表以及其他辅助信息。通过<code>Class</code>文件，<code>Java</code>虚拟机并不需要关心来源是什么语言，只要这门语言能够生成可以被读取的<code>Class</code>文件，那么它就可以在<code>Java</code>虚拟机上运行。<br>
        <code>Java</code>语言中的各种语法、关键字、常量变量和运算符号的语义最终都会转成字节码指令的组合，这就要求字节码指令的表达能力必须比<code>Java</code>语言的表达能力更强。从而，一些<code>Java</code>语言中并不支持的特性，字节码也能够表达出来。</p>
<h2 id="2-class类文件">2. <code>Class</code>类文件</h2>
<p>        <code>Class</code>文件是一组以 $8$ 个字节为单位的二进制流，数据项目按照顺序紧凑地排列在文件之中。对于 $8$ 字节以上空间的数据项，会按照高位在前的大端序分割存储在若干个 $8$ 字节中。<br>
        <code>Class</code>文件采取一种类似于<code>C</code>语言结构体的伪结构来存储数据，包含两种数据类型：</p>
<ul>
<li>无符号数：即基本数据类型，通过 $u1$ 、$u2$ 、$u3$ 、$u4$ 分别表示 $1$ 个字节、$2$ 个字节、$4$ 个字节和 $8$ 个字节的无符号数，用于表示数字、索引引用、数量值或者<code>UTF-8</code>编码的字符串；</li>
<li>表：由多个无符号数或者其他表构成的复合数据类型，一般以 $_-info$ 结尾，用于表示具有层次关系的数据。可以把整个<code>Class</code>文件都视为表，按照对应类型的数据紧凑排列而成。</li>
</ul>
<p>        当需要描述类型相同但数量不定的数据时，经常会使用一个前置的容器计数器加若干个连续的数据项的形式，称为该类型的集合。</p>
<h3 id="21-魔数和版本号">2.1 魔数和版本号</h3>
<p>        <code>Class</code>文件的头 $4$ 字节称为<strong>魔数</strong> ( $Magic\ \ Number$ )，用于确定该文件能否被虚拟机接受。魔数在很多文件格式中都存在，文件格式制定者可以自定义魔数，只要不会引起混淆。<code>Class</code>文件的魔数为 $0xCAFEBABE$ ，象征着一款咖啡。<br>
        在魔数之后是<code>Class</code>文件的版本号，前两个字节是<strong>次版本号</strong> ( $Minor\ \ Version$ )，后两个字节是<strong>主版本号</strong> ( $Major\ \ Version$ )。<code>Java</code>主版本号从 $45$ 开始，<code>JDK 1.1</code>之后每个大版本都会在之前的基础上加 $1$ 。次版本号在<code>JDK 1.1</code>及以前曾经短暂使用过，在<code>JDK 1.2</code>之后废弃，全部使用 $0$ 代替，直到<code>JDK 12</code>，由于一些复杂特性需要进行公测，于是重新启用了次版本号。</p>
<h3 id="22-常量池">2.2 常量池</h3>
<p>        常量池是<code>Class</code>文件中第一次出现表的数据项目，也是与其他项目关联最多的数据，通常也是最庞大的数据项目之一。常量池入口是一个 $u2$ 类型的数据，是<em><strong>常量池容量计数值</strong></em> ( $constant_-pool_-count$ )，从 $1$ 开始，$0$ 表示不指向常量池中的数据项目。<code>Class</code>文件中只有常量池的容量计数是从 $1$ 开始的。<br>
        常量池中主要存放字面量 ( $Literal$ ) 和符号引用 ( $Symbolic\ \ References$ )。字面量类似于<code>Java</code>中的常量，存放字符串、$final$ 常量等。符号引用则属于编译原理方面的概念，包括：</p>
<ul>
<li>被模块导出或者开放的<strong>包</strong> ( $Package$ )；</li>
<li>类和接口的<strong>全限定名</strong> ( $Fully\ \ Qualified\ \ Name$ )；</li>
<li>字段的名称和<strong>描述符</strong> ( $Descriptor$ )；</li>
<li>方法的名称和描述符；</li>
<li><strong>方法句柄</strong> ( $Method\ \ Handle$ ) 和<strong>方法类型</strong> ( $Method\ \ Type$ )；</li>
<li><strong>动态调用点</strong> ( $Dynamically-Computed\ \ Call\ \ Site$ ) 和<strong>动态常量</strong> ( $Dynamic-Computed\ \ Constant$ )。</li>
</ul>
<p>        <code>Java</code>代码在进行<code>Javac</code>编译时没有连接步骤，而是在虚拟机加载<code>Class</code>文件时进行动态连接，所以<code>Class</code>文件中不会保存方法和字段在内存中的位置信息，需要虚拟机在运行期进行转换。在类加载时，会从常量池中获取对应的符号引用，并在类创建和运行时解析，并翻译到具体内存地址中。<br>
        常量池的每一个常量都是一个表，包含 $17$ 结构不同的表结构数据，起始都是一个 $u1$ 类型标志位表示常量类型。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">标志</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$CONSTANT_-Utf8_-info$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center"><code>UTF-8</code>编码的字符串</td>
</tr>
<tr>
<td style="text-align:center">$CONSTANT_-Integer_-info$</td>
<td style="text-align:center">$3$</td>
<td style="text-align:center">整型字面量</td>
</tr>
<tr>
<td style="text-align:center">$CONSTANT_-Float_-info$</td>
<td style="text-align:center">$4$</td>
<td style="text-align:center">浮点型字面量</td>
</tr>
<tr>
<td style="text-align:center">$CONSTANT_-Long_-info$</td>
<td style="text-align:center">$5$</td>
<td style="text-align:center">长整型字面量</td>
</tr>
<tr>
<td style="text-align:center">$CONSTANT_-Double_-info$</td>
<td style="text-align:center">$6$</td>
<td style="text-align:center">双精度浮点型字面量</td>
</tr>
<tr>
<td style="text-align:center">$CONSTANT_-Class_-info$</td>
<td style="text-align:center">$7$</td>
<td style="text-align:center">类或接口的符号引用</td>
</tr>
<tr>
<td style="text-align:center">$CONSTANT_-String_-info$</td>
<td style="text-align:center">$8$</td>
<td style="text-align:center">字符串类型字面量</td>
</tr>
<tr>
<td style="text-align:center">$CONSTANT_-Fieldref_-info$</td>
<td style="text-align:center">$9$</td>
<td style="text-align:center">字段的符号引用</td>
</tr>
<tr>
<td style="text-align:center">$CONSTANT_-Methodref_-info$</td>
<td style="text-align:center">$10$</td>
<td style="text-align:center">类中方法的符号引用</td>
</tr>
<tr>
<td style="text-align:center">$CONSTANT_-InterfaceMethodref_-info$</td>
<td style="text-align:center">$11$</td>
<td style="text-align:center">接口中方法的符号引用</td>
</tr>
<tr>
<td style="text-align:center">$CONSTANT_-NameAndType_-info$</td>
<td style="text-align:center">$12$</td>
<td style="text-align:center">字段或方法的部分符号引用</td>
</tr>
<tr>
<td style="text-align:center">$CONSTANT_-MethodHandle_-info$</td>
<td style="text-align:center">$15$</td>
<td style="text-align:center">方法句柄</td>
</tr>
<tr>
<td style="text-align:center">$CONSTANT_-MethodType_-info$</td>
<td style="text-align:center">$16$</td>
<td style="text-align:center">方法类型</td>
</tr>
<tr>
<td style="text-align:center">$CONSTANT_-Dynamic_-info$</td>
<td style="text-align:center">$17$</td>
<td style="text-align:center">动态计算常量</td>
</tr>
<tr>
<td style="text-align:center">$CONSTANT_-InvokeDynamic_-info$</td>
<td style="text-align:center">$18$</td>
<td style="text-align:center">动态方法调用点</td>
</tr>
<tr>
<td style="text-align:center">$CONSTANT_-Module_-info$</td>
<td style="text-align:center">$19$</td>
<td style="text-align:center">模块</td>
</tr>
<tr>
<td style="text-align:center">$CONSTANT_-Package_-info$</td>
<td style="text-align:center">$20$</td>
<td style="text-align:center">模块中开放或者导出的包</td>
</tr>
</tbody>
</table>
<p>        起初只提供了前 $11$ 种结构，后续为了更好地支持动态语言，额外增加了 $4$ 种，之后又为了支持<code>Java</code><em><strong>模块化系统</strong></em> ( $Jigsaw$ )，又加入了两种。<br>
        我们可以通过 $javap\ \ -verbose$ 命令查看<code>Class</code>文件中常量池的常量。</p>
<h3 id="23-访问标志">2.3 访问标志</h3>
<p>        在常量池之后是<strong>访问标志</strong> ( $access_-flags$ )，由 $2$ 字节组成，用于识别一些类或者接口的访问信息，包括：<code>Class</code>是类还是接口、是否为 $public$ 、是否为 $abstract$ 、是否为 $final$ ( 如果是类 ) 等等。</p>
<table>
<thead>
<tr>
<th style="text-align:center">标志</th>
<th style="text-align:center">标志值</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$ACC_-PUBLIC$</td>
<td style="text-align:center">$0x0001$</td>
<td style="text-align:center">是否为 $public$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-FINAL$</td>
<td style="text-align:center">$0x0010$</td>
<td style="text-align:center">是否为 $final$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-SUPER$</td>
<td style="text-align:center">$0x0020$</td>
<td style="text-align:center">是否允许使用 $invokespecial$ 字节码指令的新语义，在<code>JDK 1.0.2</code>之后都设置为真</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-INTERFACE$</td>
<td style="text-align:center">$0x0200$</td>
<td style="text-align:center">表示接口</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-ABSTRACT$</td>
<td style="text-align:center">$0x400$</td>
<td style="text-align:center">是否为 $abstract$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-SYNTHETIC$</td>
<td style="text-align:center">$0x1000$</td>
<td style="text-align:center">表示该类并非由用户代码产生</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-ANNOTATION$</td>
<td style="text-align:center">$0x2000$</td>
<td style="text-align:center">表示注解</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-ENUM$</td>
<td style="text-align:center">$0x4000$</td>
<td style="text-align:center">表示枚举</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-MODULE$</td>
<td style="text-align:center">$0x8000$</td>
<td style="text-align:center">表示模块</td>
</tr>
</tbody>
</table>
<h3 id="24-索引">2.4 索引</h3>
<p>        <strong>类索引</strong> ( $this_-class$ ) 和<b>父类索引</b> ( $super_-class$ ) 都是 $u2$ 类型的数据，均指向一个 $CONSTANT_-Class_-info$ 的类描述符常量；<b>接口索引集合</b> ( $interfaces$ ) 是一组 $u2$ 类型的数据的集合，第一项 $u2$ 为接口计数器 ( $interfaces_-count$ )，表示索引表容量，后面的每一项均指向一个 $CONSTANT_-Class_-info$ 的类描述符常量。 <code>Class</code>文件通过这三项数据确定继承关系。类索引确定类的全限定名，父类索引确定类的父类的全限定名。除了 $Java.lang.Object$ 之外，所有的类都具有父类，而在 $Object$ 中，父类索引为 $0$ 。接口索引集合用于表示类实现的接口，按照声明顺序从左到右存储。</p>
<h3 id="25-字段表集合">2.5 字段表集合</h3>
<p>        <strong>字段表</strong> ( $Field_-info$ ) 用于表示接口和类中声明的变量。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$access_-flags$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$descriptor_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attributes_-count$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$attribute_-info$</td>
<td style="text-align:center">$attributes$</td>
<td style="text-align:center">$attributes_-count$</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center">标志值</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$ACC_-PUBLIC$</td>
<td style="text-align:center">$0x0001$</td>
<td style="text-align:center">是否为 $public$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-PRIVATE$</td>
<td style="text-align:center">$0x0002$</td>
<td style="text-align:center">是否为 $private$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-PROTECTED$</td>
<td style="text-align:center">$0x0004$</td>
<td style="text-align:center">是否为 $protected$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-STATIC$</td>
<td style="text-align:center">$0x0008$</td>
<td style="text-align:center">是否为 $static$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-FINAL$</td>
<td style="text-align:center">$0x0010$</td>
<td style="text-align:center">是否为 $final$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-VOLATILE$</td>
<td style="text-align:center">$0x0040$</td>
<td style="text-align:center">是否为 $volatile$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-TRANSIENT$</td>
<td style="text-align:center">$0x0080$</td>
<td style="text-align:center">是否为 $transient$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-SYNTHETIC$</td>
<td style="text-align:center">$0x1000$</td>
<td style="text-align:center">是否为编译器自动产生</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-ENUM$</td>
<td style="text-align:center">$0x4000$</td>
<td style="text-align:center">是否为 $enum$</td>
</tr>
</tbody>
</table>
<p>        接口当中的字段必须有 $ACC_-PUBLIC$ 、$ACC_-STATIC$ 、$ACC_-FINAL$ 标志。<br>
        $name_-index$ 和 $descriptor_-index$ 在标志值之后，是常量池的引用，表示字段简单名称以及字段和方法的描述符。在描述符中，基本数据类型以及 $void$ 使用一个大写字母表示，对象类型使用 $L$ 加全限定名表示。</p>
<table>
<thead>
<tr>
<th style="text-align:center">标识字符</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$B$</td>
<td style="text-align:center">$byte$</td>
</tr>
<tr>
<td style="text-align:center">$C$</td>
<td style="text-align:center">$char$</td>
</tr>
<tr>
<td style="text-align:center">$D$</td>
<td style="text-align:center">$double$</td>
</tr>
<tr>
<td style="text-align:center">$F$</td>
<td style="text-align:center">$float$</td>
</tr>
<tr>
<td style="text-align:center">$I$</td>
<td style="text-align:center">$int$</td>
</tr>
<tr>
<td style="text-align:center">$J$</td>
<td style="text-align:center">$long$</td>
</tr>
<tr>
<td style="text-align:center">$S$</td>
<td style="text-align:center">$short$</td>
</tr>
<tr>
<td style="text-align:center">$Z$</td>
<td style="text-align:center">$boolean$</td>
</tr>
<tr>
<td style="text-align:center">$V$</td>
<td style="text-align:center">$void$</td>
</tr>
<tr>
<td style="text-align:center">$L$</td>
<td style="text-align:center">对象类型</td>
</tr>
</tbody>
</table>
<p>        对于数组类型，每一个维度都会使用一个前置的 $[$ 字符表示，例如 $int[\ ][\ ]$ 会表示为 $[[I$ 。对于方法，会按照参数、返回值的方式描述，参数按照顺序放在 $(\ )$ 之中，例如 $int\ \ indexOf(char[]\ \ source,\ \ int\ \ index)$ 表示为 $([CI)I$ 。<br>
        $descriptor_-index$ 之后是属性表计数器，当字段存在额外信息如值时，计数器会记录字段的额外信息个数，并可以在之后的 $attribute_-info$ 中查询。字段表集合不会列出从父类或者父接口中继承而来的字段，但有可能出现原来<code>Java</code>代码之中不存在的字段，譬如内部类中包含的指向外部类实例的字段。</p>
<h3 id="26-方法表集合">2.6 方法表集合</h3>
<p>        <code>Class</code>文件中对字段和方法的描述采取了几乎一样的方式，同样包括 $access_-flags$、$name_-index$、$descriptor_-index$ 和 $attributes$ 。</p>
<table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center">标志值</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$ACC_-PUBLIC$</td>
<td style="text-align:center">$0x0001$</td>
<td style="text-align:center">是否为 $PUBLIC$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-PRIVATE$</td>
<td style="text-align:center">$0x0002$</td>
<td style="text-align:center">是否为 $PRIVATE$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-PROTECTED$</td>
<td style="text-align:center">$0x0004$</td>
<td style="text-align:center">是否为 $protected$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-STATIC$</td>
<td style="text-align:center">$0x0008$</td>
<td style="text-align:center">是否为 $static$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-FINAL$</td>
<td style="text-align:center">$0x0010$</td>
<td style="text-align:center">是否为 $final$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-SYNCHRONIZED$</td>
<td style="text-align:center">$0x0020$</td>
<td style="text-align:center">是否为 $synchronized$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-BRIDGE$</td>
<td style="text-align:center">$0x0040$</td>
<td style="text-align:center">是否为编译器产生的桥接方法</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-VARARGS$</td>
<td style="text-align:center">$0x0080$</td>
<td style="text-align:center">是否接受变长参数</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-NATIVE$</td>
<td style="text-align:center">$0x0100$</td>
<td style="text-align:center">是否为 $native$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-ABSTRACT$</td>
<td style="text-align:center">$0x0400$</td>
<td style="text-align:center">是否为 $abstract$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-STRICT$</td>
<td style="text-align:center">$0x0800$</td>
<td style="text-align:center">是否为 $strictfp$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-SYNTHETIC$</td>
<td style="text-align:center">$0x1000$</td>
<td style="text-align:center">是否由编译器自动产生</td>
</tr>
</tbody>
</table>
<p>        方法块内的<code>Java</code>代码，经由<code>Javac</code>编译后，存放在方法属性表集合中名为 $Code$ 的属性内。<code>Java</code>语言重载要求简单名称相同之外，还要拥有一个与原方法不同的特征签名。特征签名包括方法名称、参数顺序及参数类型。也就是说，仅仅改变返回值并不能算重载。但是<code>Class</code>文件中只要描述符不是完全一致，那么就允许多个方法共存，也即允许除了返回值之外其他都相同的方法共存。</p>
<h3 id="27-属性表集合">2.7 属性表集合</h3>
<p>        <strong>属性表</strong> ( $attribute_-info$ ) 在前面已经出现过，<code>Class</code>文件、字段表、方法表都可以包含一个属性表集合。属性表集合对顺序没有严格要求，而且可以在属性名不重复的前提下写入自定义的属性信息。<code>Java</code>虚拟机在运行时会忽略不认识的属性信息。对于每一个属性，它的名称都要从常量池中引用一个 $CONSTANT_-Utf8_-info$ 类型的常量表示。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attribute_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u4$</td>
<td style="text-align:center">$attribute_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u1$</td>
<td style="text-align:center">$info$</td>
<td style="text-align:center">$attribute_-length$</td>
</tr>
</tbody>
</table>
<p>        属性值的结构是完全自定义的，只需要通过一个 $u4$ 类型的属性说明其占用位数即可。</p>
<h4 id="271-code">2.7.1 <code>Code</code></h4>
<p>        $Code$属性存储方法体内的经过<code>Javac</code>编译后产生的字节码指令。接口方法和抽象方法中不存在该属性。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attribute_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u4$</td>
<td style="text-align:center">$attribute_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$max_-stack$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$max_-locals$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u4$</td>
<td style="text-align:center">$code_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u1$</td>
<td style="text-align:center">$code$</td>
<td style="text-align:center">$code_-length$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$exception_-table_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$exception_-info$</td>
<td style="text-align:center">$exception_-table$</td>
<td style="text-align:center">$exception_-table_-length$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attributes_-count$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$attribute_-info$</td>
<td style="text-align:center">$attributes$</td>
<td style="text-align:center">$attributes_-count$</td>
</tr>
</tbody>
</table>
<p>        $attribute_-name_-index$ 指向 $CONSTANT_-Utf8_-info$ ，固定为 $Code$ 。$attribute_-length$ 表示属性值长度，固定为属性长度减去本身以及上一个属性的长度即 $6$ 个字节。$max_-stack$ 为<b>操作数栈</b> ( $Operand\ \ Stack$ ) 深度的最大值，虚拟机根据这个值分配<b>栈帧</b> ( $Stack\ \ Frame$ ) 中的操作栈深度。$max_-locals$ 表示局部变量所需的空间，单位为<b>变量槽</b> ( $Slot$ )，即虚拟机为局部变量分配内存的最小单位。对于 $32$ 位的数据类型，会使用一个槽；而对于 $64$ 位的数据类型 $double$ 和 $long$ ，则会使用两个槽。方法参数（包括实例方法中的隐藏参数 $this$ ）、异常处理参数、局部变量都要依赖于局部变量表，<code>Javac</code>编译器会根据每个变量的生命周期和类型计算出 $max_-locals$ 的大小。$code_-length$ 和 $code$ 存储字节码指令，每个指令使用 $u1$ 类型的数据大小存储。<br>
        如果方法中存在异常处理块的话，那么异常处理表会跟在字节码指令之后。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$start_-pc$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$end_-pc$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$handler_-pc$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$catch_-type$</td>
<td style="text-align:center">$1$</td>
</tr>
</tbody>
</table>
<p>        $start_-pc$ 和 $end_-pc$ 表示出现异常的代码行，$handler_-pc$ 为处理异常的行，当 $catch_-type$ 为 $0$ 时，任何异常都要跳转到 $handler_-pc$ 进行处理。</p>
<h4 id="272-exceptions">2.7.2 <code>Exceptions</code></h4>
<p>        $Exceptions$ 属性列举出方法中可能抛出的<strong>受查异常</strong> ( $Checked\ \ Exceptions$ )，也就是方法声明时在 $throws$ 关键字后面列举的异常。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attribute_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u4$</td>
<td style="text-align:center">$attribute_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$number_-of_-exceptions$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$exception_-index_-table$</td>
<td style="text-align:center">$number_-of_-exceptions$</td>
</tr>
</tbody>
</table>
<p>        $number_-of_-exceptions$ 表示可能抛出的 $number_-of_-exceptions$ 种异常，每种异常使用一个 $exception_-index_-table$ 表示，指向 $CONSTANT_-Class_-info$ 型常量的索引，代表异常类型。</p>
<h4 id="273-linenumbertable">2.7.3 <code>LineNumberTable</code></h4>
<p>        $LineNumberTable$ 用于描述<code>Java</code>源码行号与字节码行号之间的对应关系，并非运行时的必须属性，可以在<code>Javac</code>中使用 $-g:none$ 或者 $-g:lines$ 来取消或者强制生成该信息。如果取消生成，那么当程序抛出异常时，不会显示出错的行号，并且在调试时也无法在源码处设置断点。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attribute_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u4$</td>
<td style="text-align:center">$attribute_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$line_-number_-table_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$line_-number_-info$</td>
<td style="text-align:center">$line_-number_-table$</td>
<td style="text-align:center">$line_-number_-table_-length$</td>
</tr>
</tbody>
</table>
<p>        $line_-number_-table$ 是一个数量为 $line_-number_-table_-length$ ，类型为 $line_-number_-info$ 的集合。$line_-number_-info$ 包含 $start_pc$ 和 $line_-number$ 两个 $u2$ 类型的数据，前者为字节码行号，后者为源码行号。</p>
<h4 id="274-localvariabletable和localvariabletypetable">2.7.4 <code>LocalVariableTable</code>和<code>LocalVariableTypeTable</code></h4>
<p>        $LocalVariableTable$ 描述栈帧中局部变量表与<code>Java</code>源码中变量的关系，同样并非运行时的必须属性，可以在<code>Javac</code>中使用 $-g:none$ 或者 $-g:vars$ 来取消或者强制生成该信息。如果取消生成，那么当其他人引用该方法时，所有参数名称都会丢失，<code>IDE</code>会使用譬如 $arg0$ 这样的占位符代替参数名。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attribute_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u4$</td>
<td style="text-align:center">$attribute_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$local_-variable_-table_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$local_-variable_-info$</td>
<td style="text-align:center">$local_-variable_-table$</td>
<td style="text-align:center">$local_-variable_-table_-length$</td>
</tr>
</tbody>
</table>
<p>        其中 $local_-variable_-info$ 的结构如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$start_-pc$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$descriptor_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$index$</td>
<td style="text-align:center">$1$</td>
</tr>
</tbody>
</table>
<p>        $start_-pc$ 和 $length$ 分别代表局部变量生命周期开始的字节码行数以及作用域长度；$name_-index$ 和 $descriptor_-index$ 指向 $CONSTANT_-Utf8_-info$ 类型的常量，分别代表局部变量的名称以及描述符；$index$ 存储局部变量在栈帧的局部变量表中变量槽的起始位置。<br>
        $LocalVariableTypeTable$ 类似于 $LocalVariableTable$ ，但是将 $descriptor_-index$ 替换为<b>特征签名</b> ( $Signature$ )。对于非泛型类来说，描述符和特征签名相同。但是对于泛型类，由于擦除的存在，需要特征签名来对泛型进行描述。</p>
<h4 id="275-sourcefile和sourcedebugextension">2.7.5 <code>SourceFile</code>和<code>SourceDebugExtension</code></h4>
<p>        $SourceFile$ 用于记录生成<code>Class</code>文件的源码文件名称，同样是可选的，可以在<code>Javac</code>中使用 $-g:none$ 或者 $-g:source$ 来取消或者强制生成信息。对于大多数类来说，类名和文件名一致，但是对于特殊情况如内部类，如果取消生成，那么在抛出异常时不会显示出错代码所在的文件名。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attribute_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u4$</td>
<td style="text-align:center">$attribute_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$sourcefile_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
</tbody>
</table>
<p>        $sourcefile_-index$ 指向 $CONSTANT_-Utf8_-info$ 类型的常量索引，常量值为源码文件的文件名。<br>
        <code>JDK 5</code>中加入的 $SourceDebugExtension$ 属性存储额外的代码调试信息，为非<code>Java</code>语言编写的，但需要编译成字节码在虚拟机中运行的程序，比如<code>JSP</code>等，提供了一个进行调试的标准机制。通过<code>SourceDebugExtension</code>，可以快速从异常堆栈中定位出<code>JSP</code>中出现问题的行号。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attribute_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u4$</td>
<td style="text-align:center">$attribute_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u1$</td>
<td style="text-align:center">$debug_-extension[attribute_-length]$</td>
<td style="text-align:center">$1$</td>
</tr>
</tbody>
</table>
<p>        $debug_-extension$ 存储的就是额外的调试信息，通过一组变长的<code>UTF-8</code>格式的字符串。一个类最多只允许一个 $SourceDebugExtension$ 属性。</p>
<h4 id="276-constantvalue">2.7.6 <code>ConstantValue</code></h4>
<p>        $ConstantValue$ 用于通知虚拟机自动为静态变量赋值，只有静态变量才能使用该属性。对于非静态变量，会在实例构造器 &lt;$init$&gt;$(\ )$ 方法中赋值；而静态变量可以通过类构造器 &lt;$clinit$&gt;$(\ )$ 或者 $ConstantValue$ 进行赋值。<code>Javac</code>编译器会根据变量是否为 $final$ 以及变量类型来决定是否生成 $ConstantValue$ ：如果为 $final$ 并且类型为基本类型或者 $String$ ，则生成。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attribute_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u4$</td>
<td style="text-align:center">$attribute_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$constantvalue_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
</tbody>
</table>
<p>        $constantvalue_-index$ 指向常量池中一个字面量常量的引用，可以是 $CONSTANT_-Long_-info$ 、$CONSTANT_-Integer_-info$ 等。</p>
<h4 id="277-innerclasses">2.7.7 <code>InnerClasses</code></h4>
<p>        $InnerClasses$ 用于记录内部类与宿主类之间的关联。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attribute_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u4$</td>
<td style="text-align:center">$attribute_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$number_-of_-classes$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$inner_-classes_-info$</td>
<td style="text-align:center">$inner_-class$</td>
<td style="text-align:center">$number_-of_-classes$</td>
</tr>
</tbody>
</table>
<p>        $inner_-classes_-info$ 的结构如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$inner_-class_-info_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$outer_-class_-info_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$inner_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$inner_-class_-access_flags$</td>
<td style="text-align:center">$1$</td>
</tr>
</tbody>
</table>
<p>        $inner_-class_-info_-index$ 和 $outer_-class_-info_-index$ 都指向 $CONSTANT_-Class_-info$ 类型的常量的索引，分别为内部类和宿主类的符号引用。$inner_-name_-index$ 指向 $CONSTANT_-Utf8_-info$ 类型的常量的索引，表示内部类的名称 (匿名内部类值为 $0$ )。</p>
<table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center">标志值</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$ACC_-PUBLIC$</td>
<td style="text-align:center">$0x0001$</td>
<td style="text-align:center">是否为 $public$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-PRIVATE$</td>
<td style="text-align:center">$0x0002$</td>
<td style="text-align:center">是否为 $private$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-PROTECTED$</td>
<td style="text-align:center">$0x0004$</td>
<td style="text-align:center">是否为 $protected$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-STATIC$</td>
<td style="text-align:center">$0x0008$</td>
<td style="text-align:center">是否为 $static$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-FINAL$</td>
<td style="text-align:center">$0x0010$</td>
<td style="text-align:center">是否为 $final$</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-INTERFACE$</td>
<td style="text-align:center">$0x0020$</td>
<td style="text-align:center">是否为接口</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-ABSTRACT$</td>
<td style="text-align:center">$0x0400$</td>
<td style="text-align:center">是否为抽象类</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-SYNTHETIC$</td>
<td style="text-align:center">$0x1000$</td>
<td style="text-align:center">是否为编译器自动生成</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-ANNOTATION$</td>
<td style="text-align:center">$0x2000$</td>
<td style="text-align:center">是否为注解</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-ENUM$</td>
<td style="text-align:center">$0x4000$</td>
<td style="text-align:center">是否为枚举</td>
</tr>
</tbody>
</table>
<h4 id="278-deprecated和synthetic">2.7.8 <code>Deprecated</code>和<code>Synthetic</code></h4>
<p>        $Deprecated$ 和 $Synthetic$ 都是布尔值，分别表示是否废弃和是否由编译器自动产生。后者也可以通过设置标志位 $ACC_-SYNTHETIC$ 代替。当它们存在时，即代表为真。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attribute_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u4$</td>
<td style="text-align:center">$attribute_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
</tbody>
</table>
<p>        其中 $attribute_-length$ 的值恒为 $0x00000000$ 。</p>
<h4 id="279-stackmaptable">2.7.9 <code>StackMapTable</code></h4>
<p>        $StackMapTable$ 在<code>JDK 6</code>之后加入<code>Class</code>文件结构中，位于 $Code$ 属性的属性表中，在虚拟机类加载的字节码验证阶段被<em><strong>新类型检查验证器</strong></em> ( $Type\ \ Checker$ ) 使用。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attribute_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u4$</td>
<td style="text-align:center">$attribute_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$number_-of_-entries$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$stack_-map_-frame$</td>
<td style="text-align:center">$stack_-map_-frame_-entries$</td>
<td style="text-align:center">$number_-of_-entries$</td>
</tr>
</tbody>
</table>
<p>        <code>JDK 7</code>后，如果 $Code$ 中没有 $StackMapTable$ ，那么他就具有一个隐式的 $StackMapTable$ 属性，$number_-of_-entries$ 值为 $0$ 。</p>
<h4 id="2710-signature">2.7.10 <code>Signature</code></h4>
<p>        $Signature$ 是一个可选的定长属性，可以出现在类、字段表和方法表结构的属性表中，记录泛型签名信息。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attribute_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u4$</td>
<td style="text-align:center">$attribute_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$signature_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
</tbody>
</table>
<p>        $signature_-index$ 指向 $CONSTANT_-Utf8_-info$ 类型的常量的索引，表示类签名或者方法类型或者字段类型签名。</p>
<h4 id="2711-bootstrapmethod">2.7.11 <code>BootstrapMethod</code></h4>
<p>        $BootstrapMethod$ 在<code>JDK 7</code>之后添加到<code>Class</code>文件结构中，存储 $invokedynamic$ 指令引用的引导方法限定符。如果某个<code>Class</code>文件常量池中出现过 $CONSTANT_-InvokeDynamic_-info$ 类型的常量，那么这个文件属性表中必须存在一个 $BootstrapMethod$ 属性，且最多只能有一个。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attribute_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u4$</td>
<td style="text-align:center">$attribute_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$num_-bootstrap_-methods$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$bootstrap_-method$</td>
<td style="text-align:center">$bootstrap_-methods$</td>
<td style="text-align:center">$num_-bootstrap_-methods$</td>
</tr>
</tbody>
</table>
<p>        $bootstrap_-method$ 结构如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$bootstrap_-method_-ref$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$num_-bootstrap_-arguments$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$bootstrap_-arguments$</td>
<td style="text-align:center">$num_-bootstrap_-arguments$</td>
</tr>
</tbody>
</table>
<p>        $bootstrap_-method_-ref$ 指向 $CONSTANT_-MethodHandle$ 结构的索引值，代表一个引导方法。</p>
<h4 id="2712-methodparameters">2.7.12 <code>MethodParameters</code></h4>
<p>        $MethodParameters$ 在<code>JDK 8</code>之后加入到<code>Class</code>文件结构中，用于记录变长参数中各个形参的名称和信息。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attribute_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u4$</td>
<td style="text-align:center">$attribute_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u1$</td>
<td style="text-align:center">$parameters_-count$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$parameter$</td>
<td style="text-align:center">$parameters$</td>
<td style="text-align:center">$parameters_-count$</td>
</tr>
</tbody>
</table>
<p>        其中 $parameter$ 结构如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$access_-flags$</td>
<td style="text-align:center">$1$</td>
</tr>
</tbody>
</table>
<p>        $name_-index$ 指向 $CONSTANT_-Utf8_-info$ 类型的常量的索引，表示参数名称。$access_-flags$ 是参数的状态指示器。</p>
<table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center">标志值</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$ACC_-FINAL$</td>
<td style="text-align:center">$0x0010$</td>
<td style="text-align:center">参数被 $final$ 修饰</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-SYNTHETIC$</td>
<td style="text-align:center">$0x1000$</td>
<td style="text-align:center">参数是编译器自动生成的</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-MANDATED$</td>
<td style="text-align:center">$0x8000$</td>
<td style="text-align:center">参数是在源文件中隐式定义的（如 $this$ ）</td>
</tr>
</tbody>
</table>
<h4 id="2713-模块化相关属性">2.7.13 模块化相关属性</h4>
<p>        <code>JDK 9</code>中添加了<code>Java</code>的模块化功能，因为模块描述文件 ( $module_-info.java$ ) 最终要编译为<code>Class</code>文件，所以<code>Class</code>文件结构中添加了 $Module$ 、$ModulePackages$ 和 $ModuleMainClass$ 三个属性。<br>
        $Module$ 属性是一个复杂的变长属性。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attribute_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u4$</td>
<td style="text-align:center">$attribute_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$module_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$module_-flags$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$module_-version_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$requires_-count$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$require$</td>
<td style="text-align:center">$requires$</td>
<td style="text-align:center">$requires_-count$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$exports_-count$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$export$</td>
<td style="text-align:center">$exports$</td>
<td style="text-align:center">$exports_-count$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$opens_-count$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$open$</td>
<td style="text-align:center">$opens$</td>
<td style="text-align:center">$opens_-count$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$uses_-count$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$use$</td>
<td style="text-align:center">$uses_-index$</td>
<td style="text-align:center">$uses_-count$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$provides_-count$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$provide$</td>
<td style="text-align:center">$provides$</td>
<td style="text-align:center">$provides_-count$</td>
</tr>
</tbody>
</table>
<p>        $module_-flags$ 是模块状态指示器。</p>
<table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center">标志值</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$ACC_-OPEN$</td>
<td style="text-align:center">$0x0020$</td>
<td style="text-align:center">模块开放</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-SYNTHETIC$</td>
<td style="text-align:center">$0x1000$</td>
<td style="text-align:center">模块是编译器自动生成的</td>
</tr>
<tr>
<td style="text-align:center">$ACC_-MANDATED$</td>
<td style="text-align:center">$0x8000$</td>
<td style="text-align:center">模块是在源文件中隐式定义的</td>
</tr>
</tbody>
</table>
<p>        $module_-versions_-index$ 指向 $CONSTANT_-Utf8_-info$ 类型的常量的索引，表示模块版本号。<br>
        $ModulePackages$ 用于描述模块中所有的包。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attribute_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u4$</td>
<td style="text-align:center">$attribute_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$package_-count$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$package_-index$</td>
<td style="text-align:center">$package_-count$</td>
</tr>
</tbody>
</table>
<p>        $package_-index$ 指向 $CONSTANT_-Package_-info$ 类型的常量的索引，代表模块中的一个包。<br>
        $ModuleMainClass$ 用于确定模块的主类。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attribute_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u4$</td>
<td style="text-align:center">$attribute_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$main_-class_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
</tbody>
</table>
<p>        $main_-class_-index$ 指向 $CONSTANT_-Class_-info$ 类型的常量的索引，代表模块的主类。</p>
<h4 id="2714-运行时注解相关属性">2.7.14 运行时注解相关属性</h4>
<p>        <code>Class</code>文件在<code>JDK 5</code>之后增加了 $RuntimeVisibleAnnotation$ 、$RuntimeInvisibleAnnotation$ 、$RuntimeVisibleParameterAnnotations$ 和 $RuntimeInvisibleParameterAnnotations$ 四个属性，用于支持注解。<code>JDK 8</code>之后，又添加了 $RuntimeVisibleTypeAnnotations$ 和 $RuntimeInvisibleTypeAnnotations$ 两个属性。<br>
        $RuntimeVisibleAnnotations$ 记录了类、字段或方法声明上的运行时可见注解，可以通过反射获取这个属性。</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$attribute_-name_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u4$</td>
<td style="text-align:center">$attribute_-length$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$num_-annotations$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$annotation$</td>
<td style="text-align:center">$annotations$</td>
<td style="text-align:center">$num_-annotations$</td>
</tr>
</tbody>
</table>
<p>        其中 $annotation$ 的结构如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$Type_-index$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$u2$</td>
<td style="text-align:center">$num_-element_-value_-pairs$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$element_-value_-pair$</td>
<td style="text-align:center">$element_-value_-pairs$</td>
<td style="text-align:center">$num_-element_-value_-pairs$</td>
</tr>
</tbody>
</table>
<p>        $Type_-index$ 指向 $CONSTANT_-Utf8_-info$ 类型的常量的索引，以字段描述符的形式表示一个注解；$element_-value_-pair$ 以键值对的形式表示注解的参数和值。</p>


<a href="javascript:void(0)" id="tocbtn"><i class="fas fa-bars fa-lg"></i></a>
<div id="sidetoc">
    <header>
        <h4>JVM（4）：Class文件结构</h4>
    </header>
    
    <nav id="TableOfContents">
        <ul></ul>
    </nav>
</div>
<script src=https://z217blog.cn/js/toc.js></script>



<div class="nav-next-prev">
    <div class="nav-prev">
        
        <a href="https://z217blog.cn/post/%E5%BF%AB%E9%80%9F%E4%B9%98%E7%AE%97%E6%B3%95%E7%AE%80%E4%BB%8B/"><i class="fas fa-chevron-left"></i></a>
        
    </div>
    <a class="nav-top" href="#">回到顶部</i></a>
    <div class="nav-next">
        
        <a href="https://z217blog.cn/post/%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95%E5%85%AB%E7%9A%87%E5%90%8E/"><i class="fas fa-chevron-right"></i></a>
        
    </div>
</div>
<script type="text/javascript">
    if (tocFlag) tocInit();
</script>


        </div><footer>
    <div class="footer-content">
        
        <div class="contact-info">
            
            <div class="footer-github">
                <i class="fab fa-github fa-ms"></i> <a target="_blank" href="https://github.com/z217">github.com/z217</a>
            </div>
            
            
            <div class="footer-mail">
                <i class="far fa-envelope"></i> <a href="mailto:mailto:zihan.zhouchn@outlook.com">mailto:zihan.zhouchn@outlook.com</a> </div>
            
            
        </div>
        
        
        <p class="copyright meta">Copyright © 2020–2021, z217 and the Hugo Authors; all rights reserved. Theme: <a target="_blank"
                href="https://github.com/ahmedsaadxyzz/npq-hugo">npq-hugo</a></p>
        
    </div>
</footer>


<script type="text/javascript" async
    src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [
                ['$', '$'],
                ['\\(', '\\)']
            ],
            displayMath: [
                ['$$', '$$'],
                ['\[\[', '\]\]']
            ],
            processEscapes: true,
            processEnvironments: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            TeX: {
                equationNumbers: {
                    autoNumber: "AMS"
                },
                extensions: ["AMSmath.js", "AMSsymbols.js"]
            }
        }
    });

    MathJax.Hub.Queue(function () {
        
        
        
        var all = MathJax.Hub.getAllJax(),
            i;
        for (i = 0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style></main>
</body>

</html>